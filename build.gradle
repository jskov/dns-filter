plugins {
    id 'eclipse'
	id 'io.quarkus'
    id 'java'
    id 'maven-publish'
}

group = "dk.mada.dns"
version = "1-SNAPSHOT"

repositories {
     mavenLocal()
     mavenCentral()
}

configurations {
	forEclipse
}

dependencies {
	implementation enforcedPlatform("io.quarkus:quarkus-bom:${quarkusVersion}")
    implementation "io.quarkus:quarkus-resteasy"
    implementation "io.quarkus:quarkus-undertow-websockets"
    implementation "io.quarkus:quarkus-jsonb"

    implementation "dnsjava:dnsjava:${dnsJavaVersion}"

	compileOnly 'org.immutables:value-annotations:2.7.5'
	forEclipse 'org.immutables:value:2.7.5'
	annotationProcessor 'org.immutables:value:2.7.5'

    testImplementation "io.quarkus:quarkus-junit5"
    testImplementation "io.rest-assured:rest-assured"
    testImplementation "org.assertj:assertj-core:3.11.1"
    testImplementation "dnsjava:dnsjava:${dnsJavaVersion}"
    
//    testImplementation "io.quarkus:quarkus-undertow-websockets-deployment"
}

publishing {
    publications {
        myLibrary(MavenPublication) {
            from components.java
        }
    }
}

test {
    useJUnitPlatform {
        excludeTags "accept"
    }  
    ignoreFailures = false
}

// Need to publish to MavenLocal because @QuarkusTest does not yet handle Gradle
task acceptTest(type: Test, dependsOn: "publishToMavenLocal") {
    useJUnitPlatform {
  	    includeTags "accept"
    }
    ignoreFailures = false
}

tasks.check.dependsOn(acceptTest)

sourceCompatibility = 11
targetCompatibility = 11

tasks.eclipseClasspath.dependsOn("cleanEclipseClasspath")
tasks.eclipse.doLast {
	println configurations.forEclipse.asPath
}